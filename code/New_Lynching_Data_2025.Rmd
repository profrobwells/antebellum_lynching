---
title: "New_Lynching_Data_2025"
author: "Rob Wells"
date: "2025-01-02"
output: html_document
---

```{r}
library(tidyverse)
#install.packages("arrow")
library(arrow)
library(jsonlite)
library(janitor)
library(lubridate)
```

```{r}
df <- read_feather("/Users/gizmofo/Library/CloudStorage/GoogleDrive-robwells@umd.edu/My Drive/Lynching UMD/Data/lynch_articles_1798_1963.feather")

# https://drive.google.com/file/d/1JmdHL7woEcXcdbaKOFRr1x-FSs_QgMs2/view?usp=drive_link
```


### Extract sn, create year field

```{r}

df <- df |> 
  mutate(extracted_string = str_extract(article_id, "(?:[^_]*_){3}([^_]+)")) |> 
  mutate(sn = str_replace(extracted_string, ".*_", "")) |> 
  mutate(date1 = as.Date(date, "%Y-%m-%d")) |> 
  mutate(year = year(date1)) |> 
  select(-extracted_string)

#  mutate(sn = str_extract(article_id, "sn[0-9]+")) |> 
```


```{r}
df3 <- df |> 
  filter(!is.na(sn))

```


###match with LOC metadata


# Full Library of Congress Newspaper List
```{r}


#Code from Khushboo Rathore
download_loc <- "../data/newspapers_list_2025.txt"
download.file("https://chroniclingamerica.loc.gov/newspapers.txt", download_loc)

newspaper_list <- read_delim(download_loc, delim = "|")

clean_newspaper_list <- newspaper_list %>% 
  clean_names() %>% 
  select(state, title, lccn, oclc, issn) %>% 
  rename(newspaper = title) %>% 
  mutate_all(str_squish)

#write_csv(clean_newspaper_list, "../data/newspaper_list.csv")
```


### Join df with loc list   
### 322114 articles with "lynch" but many false positives
```{r}
df1 <- df |> 
  left_join(clean_newspaper_list, by=c("sn"="lccn")) |> 
  distinct(date1, sn, newspaper_name, page, cleaned_article, article, edition, .keep_all= TRUE)

df3 <- df1 |> 
  filter(!is.na(sn))

#322114 articles with "lynch" but many false positives
#write.csv(df1, "sean_raw_lynch_articles_2025.csv")
# sean_raw_lynch_articles_2025.csv
# https://drive.google.com/file/d/1_tzP8ysdweSntHncu0M_esAxC3eLB1BV/view?usp=drive_link
```


```{r}
#Here is a chart, Figure 1, that describes lynching search results by year, counting news pages with at least one lynching story in the LOC database.
df1 %>% 
count(year) %>% 
   group_by(year) %>% 
#Sandwich it onto a simple ggplot
  ggplot(aes(x = year, y = n, fill = n)) +
  geom_col(position = "dodge") + 
  theme(legend.position = "none") +
  scale_x_continuous(labels = c(seq(1800, 1960, 10)), breaks = seq(1800, 1960, 10)) +
  labs(title = "Lynching Coverage By Year, 1805-1963", 
       subtitle = "Count of Lynching Stories Examined",
       caption = "n=321,114  articles. Peak page count: 1922: 10343	pages. Graphic by (redacted - peer review), 1/2/2025",
       y="Count of Pages",
       x="Year")
```


year total descending
```{r}
df1 %>% 
count(year) %>% 
   group_by(year) |> 
  arrange(desc(n))


```
# filtered more than 1 lynch
```{r}

df3 <- df1 |>  
  mutate(count_matches = lengths(matches))

df_cleaned <- df3 |> 
  filter(count_matches > 1)

```



year total descending
```{r}
df_cleaned %>% 
count(year) %>% 
   group_by(year) |> 
  arrange(desc(n))
```

```{r}
#Here is a chart, Figure 1, that describes lynching search results by year, counting news pages with at least one lynching story in the LOC database.
df_cleaned %>% 
count(year) %>% 
   group_by(year) %>% 
#Sandwich it onto a simple ggplot
  ggplot(aes(x = year, y = n, fill = n)) +
  geom_col(position = "dodge") + 
  theme(legend.position = "none") +
  scale_x_continuous(labels = c(seq(1800, 1960, 10)), breaks = seq(1800, 1960, 10)) +
  labs(title = "Lynching Coverage By Year, 1818-1963", 
       subtitle = "Count of Lynching Stories Examined",
       caption = "n=69,023  articles. Peak page count: 1922: 2294	pages. Graphic by (redacted - peer review), 1/2/2025",
       y="Count of Pages",
       x="Year")
```





```{r}
#df$article[18]

df3s <- df_cleaned |> 
  filter(count_matches == 3)

```


"lynchings?\W+of\W+(the\W+)?((\w+\W+){1,2})?colored"    "(murderer|fiend|desperado|brute)\W+((\w+\W+){1,2})?lynch(ed|es|ing)?(\W+|$)"    "coloreds?\W+((\w+\W+){1,2})?((was|were)\W+)?lynch(ed|es|ing)?(\W+|$)"    "lynchings?\W+of\W+(the\W+)?((\w+\W+){1,2})?negro"    "mob\W+((\w+\W+){1,2})?(hung|hang(ed|ings?|s)|lynch(ed|es|ing)?)"    "negro(e?s)?\W+((\w+\W+){1,2})?((was|were)\W+)?lynch(ed|es|ing)?(\W+|$)"    "lynchings?\W+of\W+(the\W+)?((\w+\W+){1,2})?colored"_num_matches    "(murderer|fiend|desperado|brute)\W+((\w+\W+){1,2})?lynch(ed|es|ing)?(\W+|$)"_num_matches    "coloreds?\W+((\w+\W+){1,2})?((was|were)\W+)?lynch(ed|es|ing)?(\W+|$)"_num_matches    "lynchings?\W+of\W+(the\W+)?((\w+\W+){1,2})?negro"_num_matches    "mob\W+((\w+\W+){1,2})?(hung|hang(ed|ings?|s)|lynch(ed|es|ing)?)"_num_matches    "negro(e?s)?\W+((\w+\W+){1,2})?((was|were)\W+)?lynch(ed|es|ing)?(\W+|$)"_num_matches    Unnamed: 0    "lynchings?\W+of\W+(the\W+)?((\w+\W+){1,2})?colored"_start_idx    "lynchings?\W+of\W+(the\W+)?((\w+\W+){1,2})?colored"_end_idx    "lynchings?\W+of\W+(the\W+)?((\w+\W+){1,2})?colored"_cost    "lynchings?\W+of\W+(the\W+)?((\w+\W+){1,2})?colored"_SEARCH_cost_threshold    "coloreds?\W+((\w+\W+){1,2})?((was|were)\W+)?lynch(ed|es|ing)?(\W+|$)"_start_idx    "coloreds?\W+((\w+\W+){1,2})?((was|were)\W+)?lynch(ed|es|ing)?(\W+|$)"_end_idx    "coloreds?\W+((\w+\W+){1,2})?((was|were)\W+)?lynch(ed|es|ing)?(\W+|$)"_cost    "coloreds?\W+((\w+\W+){1,2})?((was|were)\W+)?lynch(ed|es|ing)?(\W+|$)"_SEARCH_cost_threshold    "lynchings?\W+of\W+(the\W+)?((\w+\W+){1,2})?negro"_start_idx    "lynchings?\W+of\W+(the\W+)?((\w+\W+){1,2})?negro"_end_idx    "lynchings?\W+of\W+(the\W+)?((\w+\W+){1,2})?negro"_cost    "lynchings?\W+of\W+(the\W+)?((\w+\W+){1,2})?negro"_SEARCH_cost_threshold    "negro(e?s)?\W+((\w+\W+){1,2})?((was|were)\W+)?lynch(ed|es|ing)?(\W+|$)"_start_idx    "negro(e?s)?\W+((\w+\W+){1,2})?((was|were)\W+)?lynch(ed|es|ing)?(\W+|$)"_end_idx    "negro(e?s)?\W+((\w+\W+){1,2})?((was|were)\W+)?lynch(ed|es|ing)?(\W+|$)"_cost    "negro(e?s)?\W+((\w+\W+){1,2})?((was|were)\W+)?lynch(ed|es|ing)?(\W+|$)"_SEARCH_cost_threshold    "mob\W+((\w+\W+){1,2})?(hung|hang(ed|ings?|s)|lynch(ed|es|ing)?)"_start_idx    "mob\W+((\w+\W+){1,2})?(hung|hang(ed|ings?|s)|lynch(ed|es|ing)?)"_end_idx    "mob\W+((\w+\W+){1,2})?(hung|hang(ed|ings?|s)|lynch(ed|es|ing)?)"_cost    "(murderer|fiend|desperado|brute)\W+((\w+\W+){1,2})?lynch(ed|es|ing)?(\W+|$)"_start_idx    "(murderer|fiend|desperado|brute)\W+((\w+\W+){1,2})?lynch(ed|es|ing)?(\W+|$)"_end_idx    "(murderer|fiend|desperado|brute)\W+((\w+\W+){1,2})?lynch(ed|es|ing)?(\W+|$)"_cost    "mob\W+((\w+\W+){1,2})?(hung|hang(ed|ings?|s)|lynch(ed|es|ing)?)"_SEARCH_cost_threshold    "(murderer|fiend|desperado|brute)\W+((\w+\W+){1,2})?lynch(ed|es|ing)?(\W+|$)"_SEARCH_cost_threshold    batch    "lynchings?\W+of\W+(the\W+)?((\w+\W+){1,2})?colored"_CLEANING_cost_threshold    "coloreds?\W+((\w+\W+){1,2})?((was|were)\W+)?lynch(ed|es|ing)?(\W+|$)"_CLEANING_cost_threshold    "lynchings?\W+of\W+(the\W+)?((\w+\W+){1,2})?negro"_CLEANING_cost_threshold    "negro(e?s)?\W+((\w+\W+){1,2})?((was|were)\W+)?lynch(ed|es|ing)?(\W+|$)"_CLEANING_cost_threshold    "mob\W+((\w+\W+){1,2})?(hung|hang(ed|ings?|s)|lynch(ed|es|ing)?)"_CLEANING_cost_threshold    "(murderer|fiend|desperado|brute)\W+((\w+\W+){1,2})?lynch(ed|es|ing)?(\W+|$)"_CLEANING_cost_threshold    "lynchings?\W+of\W+(the\W+)?((\w+\W+){1,2})?colored"_passed_cleaning    "coloreds?\W+((\w+\W+){1,2})?((was|were)\W+)?lynch(ed|es|ing)?(\W+|$)"_passed_cleaning    "lynchings?\W+of\W+(the\W+)?((\w+\W+){1,2})?negro"_passed_cleaning    "negro(e?s)?\W+((\w+\W+){1,2})?((was|were)\W+)?lynch(ed|es|ing)?(\W+|$)"_passed_cleaning    "mob\W+((\w+\W+){1,2})?(hung|hang(ed|ings?|s)|lynch(ed|es|ing)?)"_passed_cleaning    "(murderer|fiend|desperado|brute)\W+((\w+\W+){1,2})?lynch(ed|es|ing)?(\W+|$)"_passed_cleaning

#6393 filtered
```{r}
regex_patterns <- c(
  "lynchings?\\W+of\\W+(the\\W+)?((\\w+\\W+){1,2})?colored",
  "(murderer|fiend|desperado|brute)\\W+((\\w+\\W+){1,2})?lynch(ed|es|ing)?(\\W+|$)",
  "coloreds?\\W+((\\w+\\W+){1,2})?((was|were)\\W+)?lynch(ed|es|ing)?(\\W+|$)",
  "lynchings?\\W+of\\W+(the\\W+)?((\\w+\\W+){1,2})?negro",
  "mob\\W+((\\w+\\W+){1,2})?(hung|hang(ed|ings?|s)|lynch(ed|es|ing)?)",
  "negro(e?s)?\\W+((\\w+\\W+){1,2})?((was|were)\\W+)?lynch(ed|es|ing)?(\\W+|$)"
)

# Combine patterns into a single regex
combined_pattern <- paste(regex_patterns, collapse = "|")

# Filter the dataframe: 6393 articles
filtered_df <- df1 %>%
  filter(str_detect(article, combined_pattern))
```


#edited regex with broader terms
#9937 articles
```{r}
regex_patterns <- c(
  #rough justice or "vigilance committee" or "popular justice" or "frontier justice" or "extrajudicial punishment" or rough music" or "summary execution"
   "(rough\\s+justice|vigilance\\s+committee|popular\\s+justice|frontier\\s+justice|extrajudicial\\s+punishment|rough\\s+music|summary\\s+execution)",
  #"mob" or "crowd" appear within five words of "lynch," "hung," "strung up," or "swing."
  "(mob|crowd)(\\W+\\w+){0,5}\\W+(lynch|hung|strung\\s+up|swing)",
    #lynch or lynched or lynching within five words of negro or colored
  "(negro|colored)(\\W+\\w+){0,5}\\W+lynch(ed|ing)?",
   #Matches the word "lynching" or "lynchings" (the ? makes the "s" optional).
  "lynchings?\\W+of\\W+(the\\W+)?((\\w+\\W+){1,2})?colored",
  # Matches any one of the words "murderer", "fiend", "desperado", or "brute".
  "(murderer|fiend|desperado|brute)\\W+((\\w+\\W+){1,2})?lynch(ed|es|ing)?(\\W+|$)",
  #Matches "colored" or "coloreds". and lynch
  "coloreds?\\W+((\\w+\\W+){1,2})?((was|were)\\W+)?lynch(ed|es|ing)?(\\W+|$)",
  #Matches "lynching" or "lynchings" and negro
  "lynchings?\\W+of\\W+(the\\W+)?((\\w+\\W+){1,2})?negro",
  # Matches the word "mob" "hung" and lynch.
  "mob\\W+((\\w+\\W+){1,2})?(hung|hang(ed|ings?|s)|lynch(ed|es|ing)?)",
  #negro was|were lynched
  "negro(e?s)?\\W+((\\w+\\W+){1,2})?((was|were)\\W+)?lynch(ed|es|ing)?(\\W+|$)"
)

# Combine patterns into a single regex
combined_pattern <- paste(regex_patterns, collapse = "|")

# Filter the dataframe: 9937 articles
filtered_df <- df1 %>%
  filter(str_detect(article, combined_pattern))

#write.csv(filtered_df, "lynching_filtered_2025.csv")
```


#precivil broad
```{r}
#from the broader file of 69,023 articles
precivil_broad <- df_cleaned |> 
  filter(date < "1861-04-11")
#741 articles, 1839-1861

write.csv(precivil_broad, "../data/precivil_broad.csv")

```


#precivil tightly filtered
```{r}
#from the narrow file of 9937 articles
precivil_narrow <- filtered_df |> 
  filter(date < "1861-04-11")

write.csv(precivil_narrow, "../data/precivil_narrow.csv")
#47 articles, 1844-1861

```


# compare to the Fall 2023 data analysis
```{r}
precivil_new <- read.csv("/Users/gizmofo/Code/hcij_lynching_phase_two/narratives/output/precivil_new.csv")

reviewed <- precivil_new %>% 
  filter(reviewed_by_te=="x")

reviewed %>% 
  count(state) %>% 
  arrange(desc(n))
```

Sean - I'm turning back to the pre-civil war lynching data and comparing the AI results to what we obtained with the jack regex. The AI search missed some significant material and I need to redo it. Or maybe there was another version that has better results. The AI search I was using is lynch_articles_1798_1963.feather
In the Jack regex, in 1835, we captured articles with the following (my notes: items are in precivil_new):
--Mentions the hanging of two white men and seven negroes in Livingston, Mississippi 1835 (1835-07-23
Lynchburg Virginian )
--Under a ""Lynch Law"" headline mentions the execution of two men from the Memphis Gazette. (1835-09-05 South Branch intelligencer Romney WV)
--Charleston, SC ""R.W. Carroll a hair dresser was lynched. ... His offence was dealing with, and receiving stolen goods from slaves, against which had repeatedly been warned"" (1835-09-05 South Branch intelligencer Romney WV)
None of these were in the AI captured data, which seems to match only on lynch.
The precivil war stuff needs to have more than just a lynch search term since that term itself was just coming into public discourse in the 1830s and wasnt widely used.
Let's find a few minutes to discuss. For some reason that Jack regex didn't work on the American Stories dataset - too many false positive? Am I remembering that correctly?
Maybe you could help set me up with the American Stories dataset and I could run a modified search and then dump it into AI.  T


```{r}
#Here is a chart, Figure 1, that describes lynching search results by year, counting news pages with at least one lynching story in the LOC database.
filtered_df %>% 
count(year) %>% 
   group_by(year) %>% 
#Sandwich it onto a simple ggplot
  ggplot(aes(x = year, y = n, fill = n)) +
  geom_col(position = "dodge") + 
  theme(legend.position = "none") +
  scale_x_continuous(labels = c(seq(1800, 1960, 10)), breaks = seq(1800, 1960, 10)) +
  labs(title = "Lynching Coverage By Year, 1818-1963", 
       subtitle = "Count of Lynching Stories Examined",
       caption = "n=9593  articles. Peak page count: xxx: xxx	pages. Graphic by (redacted - peer review), 1/2/2025",
       y="Count of Pages",
       x="Year")
```

Memo to Sean:
So let's chat tomorrow or next week if you have time. i'm having success filtering your big grab with a stripped down version of the jack regex. I'd like to rerun your raw "lynch" grab with this regex since it would do a better job of capturing the pre-civil war coverage. the term lynch didn't really get used until 1835. i used this filter and it cut the corpus down to 9937 articles. would like to see what it does if you re-run it. thanks. regex_patterns <- c(
  #rough justice or "vigilance committee" or "popular justice" or "frontier justice" or "extrajudicial punishment" or rough music" or "summary execution"
   "(rough\\s+justice|vigilance\\s+committee|popular\\s+justice|frontier\\s+justice|extrajudicial\\s+punishment|rough\\s+music|summary\\s+execution)",
  #"mob" or "crowd" appear within five words of "lynch," "hung," "strung up," or "swing."
  "(mob|crowd)(\\W+\\w+){0,5}\\W+(lynch|hung|strung\\s+up|swing)",
    #lynch or lynched or lynching within five words of negro or colored
  "(negro|colored)(\\W+\\w+){0,5}\\W+lynch(ed|ing)?",
   #Matches the word "lynching" or "lynchings" (the ? makes the "s" optional).
  "lynchings?\\W+of\\W+(the\\W+)?((\\w+\\W+){1,2})?colored",
  # Matches any one of the words "murderer", "fiend", "desperado", or "brute".
  "(murderer|fiend|desperado|brute)\\W+((\\w+\\W+){1,2})?lynch(ed|es|ing)?(\\W+|$)",
  #Matches "colored" or "coloreds". and lynch
  "coloreds?\\W+((\\w+\\W+){1,2})?((was|were)\\W+)?lynch(ed|es|ing)?(\\W+|$)",
  #Matches "lynching" or "lynchings" and negro
  "lynchings?\\W+of\\W+(the\\W+)?((\\w+\\W+){1,2})?negro",
  # Matches the word "mob" "hung" and lynch.
  "mob\\W+((\\w+\\W+){1,2})?(hung|hang(ed|ings?|s)|lynch(ed|es|ing)?)",
  #negro was|were lynched
  "negro(e?s)?\\W+((\\w+\\W+){1,2})?((was|were)\\W+)?lynch(ed|es|ing)?(\\W+|$)"
) (edited) 



```{r}

rds <- rio::import("/Users/robwells/Downloads/lynch_keyword_articles_classified.rds")

```

Spot check results from Sean's rds file
rds$article[1]
--basically a threatened lynching 

rds$article[2]
--definitely a lynching

rds$article[74]
The LLM explanation was wrong: The article mentions 'lynch law' being used to justify such actions, indicating it relates to a lynching event." 
rds$llm_explanation[74]

rds$article[544]
--correct, not a lynching article

rds$article[545]
--correct, not a lynching article

rds$article[554]
--? this was a potential lynching article. category 2
the llm was correct: rds$llm_explanation[554]
[1] "This article describes a situation where there was an immediate threat of lynching by the crowd, though the lynching did not occur. The use of the word 'lynching' suggests that there was a potential for it to happen in the future."


```{r}

rds1 <- rio::import("/Users/robwells/Downloads/updated_lynch_keyword_articles_classified.rds")

```


Notes from the updated text grab: 6872 articles

filtered for mob. hung

rds1$article[8]
print(rds1[8, ])
--correct: definite attempted lynching
--this is not correct: extracted_json_category_description
8                          1 An article that describes a specific lynching event that has already happened.


print(rds1[10, ])
--Correct:  extracted_json_category_description
10                          1 An article that describes a specific lynching event that has already happened.


print(rds1[67, ])
--Correct, but it was one item in a long dispatch about many other misc events.
extracted_json_category_description
67                          1 An article that describes a specific lynching event that has already happened.


print(rds1[70, ])
--Correct.  extracted_json_category_description
70                          1 An article that describes a specific lynching event that has already happened.

(sorting to 1810)

print(rds1[4662, ])
--Correct, not a lynching article


print(rds1[6872, ])
--Correct, not a lynching article


(earliest positive hit: 1825)
print(rds1[788, ])
--INCORRECT. Mentions a murder but does not describe a lynching or mob violence. "The article describes the discovery of a murdered man's body, the suspicion of foul play, and the involvement of a deaf and dumb witness. The mention of apprehending a suspect and the description of violence make it fit into the category of a specific lynching event that has already happened."

print(rds1[775, ]) (1835)
--Correct, describes attempted lynching
--The LLM description is wrong: "An article that describes a specific lynching event that has already happened.
    extracted_json_1" - The person wasn't lynched
    
print(rds1[776, ]) (1835)
--Incorrect. a reference tothe vicksburg lynching in the round up of many events. "An article that describes a specific lynching event that has already happened." - so that is accurate but it lacks context

print(rds1[777, ]) (1835)
--Correct. "An article that describes a specific lynching event that has already happened.
    extracted_json_1"
    
  print(rds1[786, ]) (1835)
  --correct. extracted_json_category_description
786                          1 An article that describes a specific lynching event that has already happened.

print(rds1[787, ]) (1835)
--correct. extracted_json_category_description
787                          1 An article that describes a specific lynching event that has already happened.



